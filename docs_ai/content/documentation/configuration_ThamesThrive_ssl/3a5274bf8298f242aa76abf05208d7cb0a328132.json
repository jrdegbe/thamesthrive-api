{"file_name": "docs/configuration/ThamesThrive_ssl.md", "questions": ["What is the procedure to run ThamesThrive API with SSL certificates provided from outside container?"], "answer": "# set the working directory in the containerRUN mkdir app/\nWORKDIR /app\n\n## Install dependencies\nCOPY app/requirements.txt .\nRUN pip install -r requirements.txt\n\n## Copy application\nCOPY app app/\nCOPY ssl ssl/\nCOPY docs manual/\nENV VARIABLE_NAME=\"application\"\n\nEXPOSE 443\nCMD [\"gunicorn\", \"-b\", \"0.0.0.0:443\", \"--workers\", \"25,\"--keyfile\", \"ssl/key.pem\", \"--certfile\", \"ssl/cert.pem\", \"-k\", \"uvicorn.workers.UvicornWorker\", \"app.main:application\"]\n```\n\nIf you would like to tweak the number of workers running change `--workers` option in `gunicorn`.\n\nThen run\n\n```\ncd ThamesThrive-api/\ndocker build . -f Dockerfile.ssl-internal -t ThamesThrive-api-ssl\n```\n\nOnce built you can run ThamesThrive with the following command:\n\n```\ndocker run -p 8686:443 -e ELASTIC_HOST=http://<your-laptop-ip>:9200 ThamesThrive-api-ssl\n```\n\nThis will make API available at __https://localhost:8686__. If you want it on the standard HTTPS port run:\n\n```\ndocker run -p 443:443 -e ELASTIC_HOST=http://<your-laptop-ip>:9200 ThamesThrive-api-ssl\n```\n\nAnd the API will be available __https://localhost__.\n\n## Running ThamesThrive API with SSL certificates provided from outside container\n\nSometimes you do not want to build the docker yourself. Then you can use the prebuilt docker and attach\nyour certificates. To do that pull `ThamesThrive/ThamesThrive-api-ssl`.\n\n```\ndocker pull ThamesThrive/ThamesThrive-api-ssl\n```\n\nThen copy your SSL certificates to any folder. For the purpose of this manual we place it in `/local/path/to/ssl`.\nYou can place it anywhere but remember to change the location in the command below:\n\n```\ndocker run \\\n-v /local/path/to/ssl:/ssl \\\n-p 8686:443 \\\n-e ELASTIC_HOST=http://<your-elastic-instance-ip>:9200 \\\n-e GUNICORN_CMD_ARGS=\"--keyfile=/ssl/key.pem --certfile=/ssl/cert.pem\" \\\nThamesThrive/ThamesThrive-api-ssl\n```\n\nIt will start ThamesThrive with files from your local `/local/path/to/ssl` folder copied/linked to internal docker folder called `/ssl`.\nIf you placed certificates inside that folder then the files will be accessible form `/ssl` in docker.\nThe Docker image expects na SSL key file to be named `key.pem` and certificate to be named `cert.pem`.\n\n## ThamesThrive API behind HTTPS proxy\n\nYou can use treafik to hide ThamesThrive API behind HTTPS proxy.\n\nRefer to this link for instructions:\nhttps://traefik.io/resources/traefik-fastapi-kuberrnetes-ai-ml/\n\n## ThamesThrive GUI in HTTPS mode\n\n```\ngit clone https://github.com/ThamesThrive/ThamesThrive-gui.git\n```\n\nFind `ThamesThrive-gui/nginix/conf-ssl/certs` and place there your certificates:\n\n* cert.pem\n* key.pem\n\nRun\n\n```\ndocker build . -f Dockerfile-https --no-cache -t ThamesThrive/ThamesThrive-gui-https\n```\n\nUse `ThamesThrive/ThamesThrive-gui-https` as you docker image instead of `ThamesThrive/ThamesThrive-gui`.\n"}
